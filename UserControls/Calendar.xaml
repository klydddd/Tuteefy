<UserControl x:Class="TuteefyWPF.UserControls.Calendar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:TuteefyWPF.UserControls"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="995"
             Background="White"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

    <UserControl.Resources>
        <!-- Accent Gradient -->
        <LinearGradientBrush x:Key="AccentGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#9600ff" Offset="0"/>
            <GradientStop Color="#AEBAF8" Offset="1"/>
        </LinearGradientBrush>

        <!-- Subtle Card Shadow -->
        <DropShadowEffect x:Key="CardShadow" BlurRadius="8" ShadowDepth="2" Opacity="0.2"/>

        <!-- Converters -->
        <local:DateSelectedMultiConverter x:Key="DateSelectedMultiConverter" />
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>

    <Grid Margin="16" UseLayoutRounding="True" SnapsToDevicePixels="True">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2.2*"/>
            <ColumnDefinition Width="1.8*"/>
        </Grid.ColumnDefinitions>

        <!-- ========== CALENDAR PANEL ========== -->
        <Border Grid.Column="0" CornerRadius="10" Background="White" Padding="12" Effect="{StaticResource CardShadow}">
            <Grid UseLayoutRounding="True" SnapsToDevicePixels="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border CornerRadius="8" Padding="8" Margin="0,0,0,10" Background="{StaticResource AccentGradient}">
                    <DockPanel>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                            <Button x:Name="PrevMonthBtn" Click="PrevMonthBtn_Click" Width="28" Height="28" Margin="4" Background="Transparent" BorderBrush="Transparent" Cursor="Hand">
                                <Path Data="M 12,4 L 6,10 L 12,16" Stroke="White" StrokeThickness="2" StrokeEndLineCap="Round" StrokeStartLineCap="Round"/>
                            </Button>
                            <Button x:Name="NextMonthBtn" Click="NextMonthBtn_Click" Width="28" Height="28" Margin="4" Background="Transparent" BorderBrush="Transparent" Cursor="Hand">
                                <Path Data="M 6,4 L 12,10 L 6,16" Stroke="White" StrokeThickness="2" StrokeEndLineCap="Round" StrokeStartLineCap="Round"/>
                            </Button>
                        </StackPanel>

                        <TextBlock Text="{Binding DisplayMonthYear}" 
                                   FontWeight="Bold" FontSize="18" 
                                   Foreground="White" VerticalAlignment="Center" 
                                   HorizontalAlignment="Center"
                                    TextOptions.TextFormattingMode="Display"
                                    TextOptions.TextRenderingMode="ClearType"
                                    SnapsToDevicePixels="True"/>
                        
                        <Button Content="Today"
                                DockPanel.Dock="Right"
                                Click="TodayBtn_Click"
                                Background="#30FFFFFF" 
                                Foreground="White"
                                BorderBrush="#20FFFFFF"
                                Padding="8,4" 
                                Cursor="Hand"
                                Margin="0,0,4,0"/>
                    </DockPanel>
                </Border>

                <!-- Weekday Header -->
                <UniformGrid Grid.Row="1" Columns="7" Margin="0,0,0,8">
                    <TextBlock Text="Sun" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#666"/>
                    <TextBlock Text="Mon" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#666"/>
                    <TextBlock Text="Tue" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#666"/>
                    <TextBlock Text="Wed" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#666"/>
                    <TextBlock Text="Thu" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#666"/>
                    <TextBlock Text="Fri" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#666"/>
                    <TextBlock Text="Sat" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#666"/>
                </UniformGrid>

                <!-- Calendar Days -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding Days}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="7"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Click="DayButton_Click"
                                        Tag="{Binding Date}"
                                        Margin="4"
                                        BorderThickness="0"
                                        Background="Transparent"
                                        Cursor="Hand">
                                    <Grid>
                                        <Border CornerRadius="6" Padding="4">
                                            <Border.Background>
                                                <MultiBinding Converter="{StaticResource DateSelectedMultiConverter}">
                                                    <Binding Path="Date"/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=UserControl}" Path="DataContext.SelectedDate"/>
                                                    <Binding Path="IsCurrentMonth"/>
                                                    <Binding RelativeSource="{RelativeSource AncestorType=UserControl}" Path="DataContext.Today"/>
                                                </MultiBinding>
                                            </Border.Background>
                                            <TextBlock Text="{Binding DayNumberDisplay}" 
                                                       HorizontalAlignment="Center" 
                                                       FontWeight="SemiBold"/>
                                        </Border>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- ========== TASK PANEL ========== -->
        <Border Grid.Column="1" CornerRadius="10" Padding="12" Margin="12,0,0,0" Background="White" Effect="{StaticResource CardShadow}">
            <Grid UseLayoutRounding="True" SnapsToDevicePixels="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="0,0,0,10">
                    <TextBlock Text="Task Tracker" FontWeight="Bold" FontSize="16"/>
                    <TextBlock Text="{Binding SelectedDate, StringFormat='{}{0:MMMM d, yyyy}'}" Foreground="#666" Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,8">
                    <Button Content="Add Task" 
                            Click="ToggleAddTask_Click" 
                            Padding="10,4"
                            Background="{StaticResource AccentGradient}" 
                            Foreground="White"
                            BorderThickness="0"
                            Margin="0,0,8,0"
                            Cursor="Hand"/>
                    <Button Content="Add Note"
                            Click="ToggleAddNote_Click"
                            Padding="10,4"
                            Background="Transparent"
                            BorderBrush="{StaticResource AccentGradient}"
                            Foreground="#333"
                            BorderThickness="1"
                            Cursor="Hand"/>
                </StackPanel>

                <!-- Add Task Input -->
                <StackPanel Grid.Row="1" Orientation="Vertical" Margin="180,0,0,0"
                            Visibility="{Binding IsAddTaskVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBox x:Name="NewTaskTextBox" Width="200" Height="25" Margin="0,4,0,4" />
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Add" Click="ConfirmAddTask_Click" Width="80" Margin="0,0,8,0"
                                Background="{StaticResource AccentGradient}" Foreground="White" BorderThickness="0" Cursor="Hand"/>
                        <Button Content="Cancel" Click="CancelAddTask_Click" Width="80" Cursor="Hand"/>
                    </StackPanel>
                </StackPanel>

                <!-- Add Note Input -->
                <StackPanel Grid.Row="1" Orientation="Vertical" Margin="180,0,0,0"
                            Visibility="{Binding IsAddNoteVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBox x:Name="NewNoteTextBox" Width="200" Height="50" Margin="0,4,0,4" AcceptsReturn="True" TextWrapping="Wrap"/>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Add" Click="ConfirmAddNote_Click" Width="80" Margin="0,0,8,0"
                                Background="{StaticResource AccentGradient}" Foreground="White" BorderThickness="0" Cursor="Hand"/>
                        <Button Content="Cancel" Click="CancelAddNote_Click" Width="80" Cursor="Hand"/>
                    </StackPanel>
                </StackPanel>

                <ScrollViewer Grid.Row="2">
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="Tasks" FontWeight="SemiBold" Margin="0,4,0,8"/>
                        <ItemsControl ItemsSource="{Binding DisplayedTasks}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" CornerRadius="6" Padding="8" Margin="0,4,0,4" BorderBrush="#DDD" BorderThickness="1">
                                        <DockPanel>
                                            <StackPanel>
                                                <TextBlock Text="{Binding Title}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding CreatedAt, StringFormat='Added {0:t}'}" Foreground="#777" FontSize="11"/>
                                            </StackPanel>
                                            <Button Content="Done" DockPanel.Dock="Right" Click="CompleteTask_Click" Tag="{Binding Id}"
                                                    Margin="6,0,0,0" Padding="6,2" Cursor="Hand"/>
                                        </DockPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <TextBlock Text="Notes" FontWeight="SemiBold" Margin="0,12,0,8"/>
                        <ItemsControl ItemsSource="{Binding DisplayedNotes}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#FAFAFA" CornerRadius="6" Padding="8" Margin="0,4,0,4" BorderBrush="#EEE" BorderThickness="1">
                                        <TextBlock Text="{Binding}" TextWrapping="Wrap"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
